<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Hiyori Test</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#111}
    #app{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // CDN ìˆœì°¨ ë¡œë”© ì‹œìŠ¤í…œ
    async function loadScript(url) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = url;
        script.onload = () => {
          console.log('âœ… ë¡œë“œ ì„±ê³µ:', url);
          resolve();
        };
        script.onerror = () => {
          console.error('âŒ ë¡œë“œ ì‹¤íŒ¨:', url);
          reject(new Error(`Failed to load: ${url}`));
        };
        document.head.appendChild(script);
      });
    }

    async function init() {
      try {
        // 1. Pixi.js ë¡œë“œ
        console.log('ğŸ“¦ Pixi.js ë¡œë”© ì¤‘...');
        await loadScript('https://cdn.jsdelivr.net/npm/pixi.js@6.5.8/dist/browser/pixi.min.js');
        console.log('âœ… PIXI ë²„ì „:', PIXI.VERSION);

        // 2. Live2D Cubism Core ë¡œë“œ
        console.log('ğŸ“¦ Live2D Cubism Core ë¡œë”© ì¤‘...');
        await loadScript('https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js');
        console.log('âœ… Live2DCubismCore ì¡´ì¬:', typeof Live2DCubismCore);

        // 3. pixi-live2d-display ë¡œë“œ (ì—¬ëŸ¬ CDN ì‹œë„)
        console.log('ğŸ“¦ pixi-live2d-display ë¡œë”© ì¤‘...');
        
        const cdnUrls = [
          'https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.js',
          'https://unpkg.com/pixi-live2d-display@0.4.0/dist/cubism4.js',
          'https://cdn.jsdelivr.net/gh/guansss/pixi-live2d-display@v0.4.0/dist/cubism4.js'
        ];

        let loaded = false;
        for (const url of cdnUrls) {
          try {
            console.log('ğŸ”„ ì‹œë„ ì¤‘:', url);
            await loadScript(url);
            if (PIXI.live2d && PIXI.live2d.Live2DModel) {
              console.log('âœ… pixi-live2d-display ë¡œë“œ ì„±ê³µ!');
              loaded = true;
              break;
            }
          } catch (e) {
            console.warn('âš ï¸ ì´ CDNì€ ì‹¤íŒ¨, ë‹¤ìŒ ì‹œë„:', e.message);
          }
        }

        if (!loaded) {
          throw new Error('ëª¨ë“  CDNì—ì„œ pixi-live2d-display ë¡œë“œ ì‹¤íŒ¨');
        }

        console.log('=== ìµœì¢… í™•ì¸ ===');
        console.log('PIXI.live2d:', typeof PIXI.live2d);
        console.log('PIXI.live2d.Live2DModel:', typeof PIXI.live2d.Live2DModel);
        console.log('==================');

        // 4. Pixi ì•± ìƒì„±
        const app = new PIXI.Application({ 
          backgroundAlpha: 0, 
          resizeTo: window 
        });
        document.getElementById("app").appendChild(app.view);

        // 5. Live2D ëª¨ë¸ ë¡œë“œ
        const MODEL_URL = "public/models/hiyori_free_ko/runtime/hiyori_free_t08.model3.json";
        
        console.log('ğŸ“¦ Live2D ëª¨ë¸ ë¡œë”© ì¤‘:', MODEL_URL);
        const model = await PIXI.live2d.Live2DModel.from(MODEL_URL);
        
        console.log('âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ!');

        // ëª¨ë¸ ìœ„ì¹˜ ì„¤ì • (í¬ê¸° ì¶•ì†Œ)
        model.anchor.set(0.5, 1);
        model.scale.set(0.15); // 0.5ì—ì„œ 0.2ë¡œ ì¶•ì†Œ
        model.position.set(window.innerWidth / 2, window.innerHeight);
        
        app.stage.addChild(model);

        // í´ë¦­ ëª¨ì…˜
        model.interactive = true;
        model.on("pointertap", () => {
          console.log('ğŸ‘† ìºë¦­í„° í´ë¦­!');
          if (model.motion) {
            model.motion("Tap");
          }
        });

        console.log('ğŸ‰ ëª¨ë“  ì„¤ì • ì™„ë£Œ! ìºë¦­í„°ë¥¼ í´ë¦­í•´ë³´ì„¸ìš”!');

      } catch (e) {
        console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
        document.getElementById('app').innerHTML = 
          `<div style="color:white;padding:20px;font-family:monospace;">
            <h2>âŒ ë¡œë“œ ì‹¤íŒ¨</h2>
            <p>${e.message}</p>
            <p>F12ë¥¼ ëˆŒëŸ¬ Console íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.</p>
          </div>`;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
